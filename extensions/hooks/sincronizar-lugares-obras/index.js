"use strict";var a=({action:a},{services:e})=>{const{ItemsService:i}=e;async function s(a,e){if(!e.accountability)return;let s=[];a.key?s.push(a.key):s=a.keys;const t=new i("obras",{schema:e.schema,knex:e.database}),c=new i("ubicaciones",{schema:e.schema,kenx:e.database});for await(const a of s){const e=await t.readOne(a);if(e.ubicacion){const i=await c.readByQuery({filter:{id:{_eq:e.ubicacion}},fields:["ciudad.id","ciudad.pais"]});if(i&&i.length){const{ciudad:e}=i[0];await t.updateOne(a,{ciudad:e.id,pais:e.pais})}}else await t.updateOne(a,{ciudad:null,pais:null})}}a("obras.items.create",s),a("obras.items.update",s),a("obras.items.delete",s)};module.exports=a;
